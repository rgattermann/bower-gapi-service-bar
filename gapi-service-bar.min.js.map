{"version":3,"sources":["app.module.js","gapi-service-bar-routes.js","gapi-service-bar-controller.js","gapi-service-bar-directive.js","gapi-service-bar-factory.js","gapi-service-bar-request-interceptor.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"gapi-service-bar.min.js","sourcesContent":["/*global angular,console*/\r\n(function () {\r\n    'use strict';\r\n\r\n    // Module dependencies injection\r\n    angular.module('gapiServiceBar', [ 'aruba.js' ]);\r\n\r\n}());\r\n","/*global angular */\r\n(function () {\r\n    'use strict';\r\n\r\n    angular.module('gapiServiceBar').config([ '$httpProvider', function ($httpProvider) {\r\n\r\n        // Interceptor to add token on every Header Request\r\n        $httpProvider.interceptors.push('gapiServiceBarRequestInterceptor');\r\n\r\n    }]);\r\n\r\n}());","/*global angular, console, $ */\r\n(function () {\r\n    \"use strict\";\r\n\r\n    function GapiServiceBarController($scope, $rootScope, gapiServiceBarFactory) {\r\n\r\n        /* $scope Functions */\r\n        $scope.userPanel = function () {\r\n            console.log('UserPanel');\r\n        };\r\n\r\n        $scope.userSettings = function () {\r\n            console.log('UserSettings');\r\n        };\r\n\r\n        $scope.userHelp = function () {\r\n            console.log('userHelp');\r\n        };\r\n\r\n        $scope.openTicket = function () {\r\n            console.log('openTicket');\r\n        };\r\n\r\n        $scope.logout = function () {\r\n            gapiServiceBarFactory.logout();\r\n        };\r\n\r\n        $rootScope.$on('GAPI-LOGOUT', function () {\r\n            console.log('GAPI-SERVICE-BAR (-.-) LOGOUT');\r\n        });\r\n\r\n        (function () {\r\n\r\n            // If the user is not logged will be redirected to accounts\r\n            gapiServiceBarFactory.validateUser().then(function () {\r\n\r\n                // Service Bar Title\r\n                $scope.companyName = gapiServiceBarFactory.getCompanyName();\r\n\r\n                // Service Bar Application Name\r\n                $scope.currentApplicationName = gapiServiceBarFactory.getCurrentApplication();\r\n\r\n                // Service Bar User\r\n                $scope.user = gapiServiceBarFactory.getUser();\r\n\r\n                // Service Bar Applications\r\n                $scope.applications = gapiServiceBarFactory.getApplications();\r\n\r\n                // Service Bar Notifications\r\n                $scope.notifications = gapiServiceBarFactory.getNotifications();\r\n\r\n                // Service Bar Messages\r\n                $scope.messages = gapiServiceBarFactory.getMessages();\r\n            });\r\n\r\n        }());\r\n\r\n    }\r\n\r\n    GapiServiceBarController.$inject = [ '$scope', '$rootScope', 'gapiServiceBarFactory' ];\r\n\r\n    angular.module('gapiServiceBar').controller('GapiServiceBarController', GapiServiceBarController);\r\n\r\n}());\r\n","/*global angular, console, document, $*/\r\n\r\nangular.module('gapiServiceBar').directive('gapiServiceBar', function () {\r\n    \"use strict\";\r\n\r\n    return {\r\n        restrict: 'E',\r\n        templateUrl: '../vendor/gapi-service-bar/gapi-service-bar.html',\r\n        controller: 'GapiServiceBarController',\r\n\r\n        link: function () {\r\n\r\n            (function () {\r\n\r\n                // Add slidedown animation to dropdown\r\n                $('.dropdown').on('show.bs.dropdown', function () {\r\n                    $(this).find('.dropdown-menu').first().stop(true, true).slideDown();\r\n                });\r\n\r\n                // Add slideup animation to dropdown\r\n                $('.dropdown').on('hide.bs.dropdown', function () {\r\n                    $(this).find('.dropdown-menu').first().stop(true, true).slideUp();\r\n                });\r\n\r\n            }());\r\n\r\n        }\r\n    };\r\n\r\n});\r\n","/*global angular, console, FormData, window*/\r\n/*jslint todo: true */\r\n\r\n(function () {\r\n    \"use strict\";\r\n\r\n    function GapiServiceBarFactory($http, $q, $window, $rootScope, core) {\r\n\r\n        var factory = {\r\n\r\n            validateUser: function () {\r\n\r\n                // Creating Promise\r\n                var tokenDefer = $q.defer(),\r\n                    token;\r\n\r\n                // Checking if it comes from accounts with querystring token\r\n                if (window.location.search.split('=')[1]) {\r\n                    // Will set token to SessionStorage\r\n                    this.setToken(window.location.search.split('=')[1]);\r\n                } else {\r\n\r\n                    // If there's no token will redirect to accounts to get a new one\r\n                    token = this.getToken();\r\n                    if (!token) {\r\n                        $window.location.href = this.getAccountsUrl();\r\n                        tokenDefer.reject();\r\n                    }\r\n                }\r\n\r\n                // Validating Token against Core Server\r\n                this.validateToken(function (err, data) {\r\n\r\n                    if (err || !data.result) {\r\n                        tokenDefer.reject(err || 'No Data');\r\n                    }\r\n\r\n                    // Setting User Data\r\n                    $window.localStorage.setItem('GAPI-USER', JSON.stringify(data.result));\r\n\r\n                    // Resolving Promise\r\n                    tokenDefer.resolve();\r\n                });\r\n\r\n                return tokenDefer.promise;\r\n            },\r\n\r\n            validateToken: function (cb) {\r\n                $http.get(core.getCoreUrl() + 'credentials/me')\r\n                    .success(function (data) {\r\n                        cb(null, data);\r\n                    })\r\n                    .error(function (err) {\r\n                        console.log('[ERROR - validateToken]: ', err);\r\n                        cb(err, null);\r\n                    });\r\n            },\r\n\r\n            setToken: function (token) {\r\n                $window.localStorage.setItem('GAPI-TOKEN', token);\r\n            },\r\n\r\n            getToken: function () {\r\n                return $window.localStorage.getItem('GAPI-TOKEN');\r\n            },\r\n\r\n            logout: function () {\r\n\r\n                $http.get(core.getCoreUrl() + 'accounts/credentials/_logout/')\r\n                    .success(function (data) {\r\n                        // Remove User\r\n                        $window.localStorage.removeItem('GAPI-USER');\r\n\r\n                        // Remove Token\r\n                        $window.sessionStorage.removeItem('GAPI-TOKEN');\r\n\r\n                        // Promise Resolve\r\n                        $rootScope.$broadcast('GAPI-LOGOUT', data);\r\n                    })\r\n                    .error(function (err) {\r\n                        // Promise Reject\r\n                        $rootScope.$broadcast('GAPI-LOGOUT', err);\r\n                    });\r\n\r\n            },\r\n\r\n            getUser: function () {\r\n                var localGapiUser = JSON.parse($window.localStorage.getItem('GAPI-USER'));\r\n                return localGapiUser.user;\r\n            },\r\n\r\n            getCompanyName: function () {\r\n                return 'Cliente';\r\n            },\r\n\r\n            getApplications: function () {\r\n                var localGapiUser = JSON.parse($window.localStorage.getItem('GAPI-USER'));\r\n                return localGapiUser.applications;\r\n            },\r\n\r\n            getNotifications: function () {\r\n                // TODO: Implement Websockets\r\n                return [{\"aplicacao\": \"Integra\", \"description\": \"Notificação de Teste\", \"timespan\": \"Agora pouco\"}];\r\n            },\r\n\r\n            getMessages: function () {\r\n                return [];\r\n            },\r\n\r\n            getCurrentApplication: function () {\r\n                var currentApplication = core.getApplicationName();\r\n                return currentApplication + ' | ';\r\n            },\r\n\r\n            getAccountsUrl: function () {\r\n                return core.getAccountsUrl();\r\n            }\r\n\r\n        };\r\n\r\n        return factory;\r\n\r\n    }\r\n\r\n    GapiServiceBarFactory.$inject = [ '$http', '$q', '$window', '$rootScope', 'coreApiService' ];\r\n\r\n    angular.module('gapiServiceBar').factory('gapiServiceBarFactory', GapiServiceBarFactory);\r\n\r\n}());\r\n","/*global angular, console*/\r\n(function () {\r\n    \"use strict\";\r\n\r\n    function GapiServiceBarRequestInterceptor($q, $window) {\r\n\r\n        return {\r\n\r\n            // On request success\r\n            request: function (config) {\r\n                // Add Token info to every request\r\n                config.headers['X-Session-Token'] = $window.localStorage.getItem('GAPI-TOKEN');\r\n\r\n                return config;\r\n            },\r\n\r\n            // On request error\r\n            requestError: function (reason) {\r\n                // Return the promise error reason.\r\n                return $q.reject(reason);\r\n            },\r\n\r\n            // On response success\r\n            response: function (response) {\r\n                // Return the response or promise.\r\n                return response || $q.when(response);\r\n            },\r\n\r\n            // On response error\r\n            responseError: function (reason) {\r\n                // Return the promise error reason.\r\n                return $q.reject(reason);\r\n            }\r\n\r\n        };\r\n    }\r\n\r\n    GapiServiceBarRequestInterceptor.$inject = [ '$q', '$window' ];\r\n\r\n    angular.module('gapiServiceBar').factory('gapiServiceBarRequestInterceptor', GapiServiceBarRequestInterceptor);\r\n\r\n}());\r\n"],"sourceRoot":"/source/"}